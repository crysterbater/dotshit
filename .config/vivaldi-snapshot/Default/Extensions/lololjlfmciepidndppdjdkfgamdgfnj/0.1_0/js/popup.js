function windowDownloadPhoto(o){showDownloadControls(!0),showDownloadMultipleControls(!1),showCantDownloadControls(!1);var e=new FlickrApi;e.getPhotoSizes(o,function(a,n){if(1==a){for(var s=$('<ul id="loadedSizes"/>'),t=!1,i=0;i<n.length;i++)!function(){var a=n[i],l=Math.min(a.height,a.width);if(!t&&(l>=320||!n.hasOwnProperty(i+1))){t=!0;var r=$("#loadedImg");if(r.attr("src",a.source),r.parent().css("overflow","hidden"),a.height<a.width){var d=320/a.height;r.attr("height",320),r.css("marginLeft",-((a.width*d-320)/2)+"px")}else{var d=320/a.width;r.attr("width",320),r.css("marginTop",-((a.height*d-320)/2)+"px")}}var c=$('<i class="download" title="Download this size of photo to your computer"><img src="img/ic_download.png" alt=""/></i><div class="pxdownloader_spinnerWrapper"><div class="pxdownloader_bg"></div><div class="pxdownloader_spinner"></div></div>');c.click(function(){var n=$(this);n.hasClass("loading")||(showLoader(!0,n),trackDownload(o,a.label),e.getPhotoInfo(o,function(o,e){showLoader(!1,n),1==o?(chrome.runtime.sendMessage({action:"download",src:a.source,data:e}),window.close()):alert(e)}))});var w=$('<i class="open" title="Open this size of photo in a new tab"><img src="img/ic_new_window.png" alt=""/></i>');w.click(function(){trackViewFullSize(o,a.label),chrome.runtime.sendMessage({action:"openNewTab",src:a.source,active:!0}),window.close()});var h=$("<li>"+a.width+"&nbsp;x&nbsp;"+a.height+"px</li>");h.append(c),h.append(w),s.append(h)}();$("#downloadImage .loadedSizesWrap .loadedSizesList").append(s)}})}function processImagesToDownload(o){showDownloadControls(!0),showDownloadMultipleControls(!0),showCantDownloadControls(!1),chrome.tabs.getSelected(null,function(e){chrome.tabs.sendRequest(e.id,{action:o},function(e){if(e.action==o)for(var a=e.data,n=$("#imagesWrapper").html("<ul />"),s=0;s<a.length;s++)!function(){var o=a[s];o.src.startsWith("//")&&(o.src=o.src.substring(2),o.src="https://"+o.src);var e=$('<li><img src="'+o.src+'" title="Show available sizes"/></li>');e.click(function(){windowDownloadPhoto(o.id)}),n.append(e)}()})})}function showDownloadControls(o){o?($("#cancel").show(),$("#cancel").off().click(function(){window.close()})):$("#cancel").hide()}function showDownloadMultipleControls(o){o?($("#multipleImagesDownload").show(),$("#downloadImage").hide()):($("#multipleImagesDownload").hide(),$("#downloadImage").show())}function showCantDownloadControls(o){o?($("#cantDownload").show(),$("#okBtn").show()):($("#cantDownload").hide(),$("#okBtn").hide())}onReady(),document.addEventListener("DOMContentLoaded",function(){chrome.tabs.getSelected(null,function(o){var e=o.url,a=getCurrentPageType(e);if(trackShowPopup(e),$("#versionNumber").size()>0){var n=chrome.runtime.getManifest();$("#versionNumber").html(n.version)}switch(config.isPro?$(".onlyPro").show():$(".onlyNoPro").show(),!config.isPro&&config.downloadLimit>0?($("#downloadLimit").html("/"+config.downloadLimit),$("#downloadLimit").show()):$("#downloadLimit").hide(),$("#downloadedToday").html(pxVariables.todayDownloaded),a){case flickrPageTypes.photoDetail:var s=getPhotoId(e,a);windowDownloadPhoto(s);break;case flickrPageTypes.exploreRecent:case flickrPageTypes.cameraDetail:case flickrPageTypes.userPhotos:case flickrPageTypes.setOfPhotos:case flickrPageTypes.favorites:processImagesToDownload("getImagesFromRecent");break;case flickrPageTypes.commons:processImagesToDownload("getImagesFromCommons");break;case flickrPageTypes.under20:processImagesToDownload("getImagesFromUnder20");break;case flickrPageTypes.groupPool:processImagesToDownload("getImagesFromGroupPool");break;case flickrPageTypes.galleryOfPhotos:processImagesToDownload("getImagesFromGallery");break;case flickrPageTypes.searchPhotos:processImagesToDownload("getImagesFromSearch")}config.isPro||$("#donateButton").click(function(){trackDonateClicked();var o=getDateInfo("CUR_DATE");return saveOptions({donationClicked:!0,donationClickedDate:o},function(){}),!0})})}),document.addEventListener("DOMContentLoaded",documentLoaded);