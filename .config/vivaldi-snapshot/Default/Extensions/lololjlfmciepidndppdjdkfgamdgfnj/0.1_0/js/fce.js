function dump(e,t){var r="";for(var n in e)r+=n+": "+e[n]+"\n";debug(r,t)}function debug(e,t){config.isDebugMode&&(1==t?alert(e):console.log(e))}function getDiacriticsRemovalMap(){if(null==pxVariables.diacriticsMap){pxVariables.diacriticsMap={};for(var e=0;e<pxVariables.defaultDiacriticsRemovalMap.length;e++)for(var t=pxVariables.defaultDiacriticsRemovalMap[e].letters.split(""),r=0;r<t.length;r++)pxVariables.diacriticsMap[t[r]]=pxVariables.defaultDiacriticsRemovalMap[e].base}return pxVariables.diacriticsMap}function removeDiacritics(e){var t=getDiacriticsRemovalMap();return e.replace(/[^\u0000-\u007E]/g,function(e){return t[e]||e})}function transliterate(e){for(var t in pxVariables.cyrillic)e=e.replace(t,pxVariables.cyrillic[t]);return e}function reduceArraySize(e,t){var r=Object.size(e),n=r-t;if(n>0)for(var a in e){if(0==n)break;e.hasOwnProperty(a)&&(n--,delete e[a])}return e}function isFunction(e){var t={};return e&&"[object Function]"===t.toString.call(e)}function isDefined(e){return"undefined"!=e&&"undefined"!=typeof e}function textToUrl(e){return e=e.replace(/^\s+|\s+$/g,""),e=transliterate(e),e=removeDiacritics(e),e=e.toLowerCase(),e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}function canDownload(e){return e=parseInt(e),config.isPro||config.downloadLimit<=0||config.downloadLimit>e?!0:!1}function isWholeNumber(e){return isDefined(e)&&null!=e?/^\d+$/.test(e):!1}function getUrlValidString(e){var t="";if(null!==e){var r=textToUrl(e);""!==r&&"untitled"!==r&&(t+="-"+r)}for(;""!=t&&t.lastIndexOf("-")==t.length-1;)t=t.substring(0,t.length-1);for(;""!=t&&0==t.indexOf("-");)t=t.substring(1,t.length);for(;""!=t&&t.indexOf("--")>=0;)t=t.replace("--","-");return""==t&&(t="-"),t}function getFilenamePartByConstant(e,t){var r="";try{switch(e){case"ID":r=t.id;break;case"URL_VALID_NAME":r=getUrlValidString(t.title._content);break;case"NAME":r=t.title._content;break;case"URL_VALID_AUTHOR_NAME":r=getUrlValidString(t.author);break;case"AUTHOR_NAME":r=t.owner.realname;break;case"URL_VALID_AUTHOR_USERNAME":r=getUrlValidString(t.owner.realname);break;case"AUTHOR_USERNAME":r=t.owner.username;break;default:e.startsWith("CUR_DATE")?r=getDateInfo(e):e.startsWith("UPLOADED_DATE")&&(r=getDateInfo(e,t.dateuploaded))}}catch(n){}return r}function getDateInfo(e,t){e=e.replace("CUR_DATE","DATE"),e=e.replace("UPLOADED_DATE","DATE");var r=null;r=isDefined(t)?new Date(1e3*parseInt(t)):new Date;var n="";switch(e){case"DATE":var a=prependZeros(r.getMonth()+1,2),i=prependZeros(r.getDate(),2);n=r.getFullYear()+"-"+a+"-"+i;break;case"DATE_Y":n=""+r.getFullYear();break;case"DATE_y":n=""+r.getFullYear(),n=n.substring(2,n.length);break;case"DATE_n":n=""+(r.getMonth()+1);break;case"DATE_m":n=""+prependZeros(r.getMonth()+1,2);break;case"DATE_j":n=""+r.getDate();break;case"DATE_d":n=""+prependZeros(r.getDate(),2);break;case"DATE_a":n=""+getAmPm(r);break;case"DATE_g":n=""+getHours12Format(r);break;case"DATE_G":n=""+r.getHours();break;case"DATE_h":n=""+prependZeros(getHours12Format(r));break;case"DATE_H":n=""+prependZeros(r.getHours());break;case"DATE_i":n=""+r.getMinutes();break;case"DATE_s":n=""+r.getSeconds()}return n}function getHours12Format(e){var t=e.getHours();return t%=12,t=t?t:12}function getAmPm(e){var t=e.getHours(),r=t>=12?"pm":"am";return r}function prependZeros(e,t){for(e+="";e.length<t;)e="0"+e;return e}function getResultFileName(e,t,r){isDefined(t)&&1==config.isPro||(t=config.defaultFilenameFormat);for(var n,a=/\{\{(.*?)\}\}/gi,i=t;n=a.exec(t);)i=i.replace("{{"+n[1]+"}}",getFilenamePartByConstant(n[1],e));return config.isPro&&(r+="",r=r.trim(),(r.startsWith("/")||r.startsWith("\\"))&&(r=r.substring(1,r.length)),(r.endsWith("/")||r.endsWith("\\"))&&(r=r.substring(0,r.length-1)),""!=r&&(i=r+"/"+i)),i}function getCurrentPageType(e){var t=getUrlParts(e);return isDefined(t[0])&&"photos"==t[0]&&isDefined(t[2])&&"tags"==t[2]&&isDefined(t[3])?flickrPageTypes.searchPhotos:isDefined(t[0])&&"search"==t[0]?flickrPageTypes.searchPhotos:isDefined(t[0])&&"photos"==t[0]&&isDefined(t[2])&&"sets"==t[2]&&isDefined(t[3])&&isWholeNumber(t[3])?flickrPageTypes.setOfPhotos:isDefined(t[0])&&"photos"==t[0]&&isDefined(t[2])&&"galleries"==t[2]&&isDefined(t[3])&&isWholeNumber(t[3])?flickrPageTypes.galleryOfPhotos:isDefined(t[0])&&"photos"==t[0]&&isDefined(t[2])&&"favorites"==t[2]?flickrPageTypes.favorites:isDefined(t[0])&&"photos"==t[0]&&isDefined(t[2])&&isWholeNumber(t[2])?flickrPageTypes.photoDetail:isDefined(t[0])&&"photos"==t[0]&&isDefined(t[1])&&(!isDefined(t[2])||"with"==t[2]||t[2].startsWith("page"))?flickrPageTypes.userPhotos:isDefined(t[0])&&"explore"==t[0]?flickrPageTypes.exploreRecent:isDefined(t[0])&&"commons"==t[0]?flickrPageTypes.commons:isDefined(t[0])&&"20under20"==t[0]?flickrPageTypes.under20:isDefined(t[0])&&"cameras"==t[0]&&isDefined(t[1])&&isDefined(t[2])?flickrPageTypes.cameraDetail:isDefined(t[0])&&"groups"==t[0]&&isDefined(t[2])&&"pool"==t[2]?flickrPageTypes.groupPool:flickrPageTypes.unknown}function getPhotoId(e,t){var r=getUrlParts(e);return t==flickrPageTypes.photoDetail?r[2]:void 0}function isFlickrUrl(e){return e.startsWith("https://www.flickr.com")||e.startsWith("https://flickr.com")||e.startsWith("http://www.flickr.com")||e.startsWith("http://flickr.com")}function getUrlParts(e){if(isDefined(pxVariables.urlPartsCache[e]))return pxVariables.urlPartsCache[e];var t=e.replace("https://www.flickr.com","");t=t.replace("http://www.flickr.com","");var r=t.lastIndexOf("?");r>-1&&(t=t.substring(0,r));var n=t.split("/");return n=n.clean(),pxVariables.urlPartsCache[e]=n,n}function translateDocument(){config.isPro&&($("[data-l10n]").each(function(){$(this).html(_($(this).attr("data-l10n"))),$(this).removeAttr("data-l10n")}),$("[data-l10n-title]").each(function(){$(this).attr("title",_($(this).attr("data-l10n-title"))),$(this).removeAttr("data-l10n-title")}))}function saveOptions(e,t){chrome.storage.sync.set(e,function(){isDefined(t)?t():alert(_("optionSaved"))})}function getOptions(e,t){chrome.storage.sync.get(e,function(e){t(e)})}function getTodayDownloaded(e){getOptions({downloadCounterDaily:{}},function(t){var r=getDownloadedOnSpecificDate(t.downloadCounterDaily,getDateInfo("CUR_DATE"));e(r)})}function getArrayFromJson(e){var t={};try{t=JSON.parse(e)}catch(r){t={}}return t}function getDownloadedOnSpecificDate(e,t){var r=getArrayFromJson(e);return isDefined(r[t])?r[t]:0}function incrementDownloadCounter(){var e=getDateInfo("CUR_DATE");try{chrome.storage.sync.get({downloadCounterDaily:{},downloadCounterTotal:0},function(t){var r=getArrayFromJson(t.downloadCounterDaily),n=t.downloadCounterTotal;isDefined(r[e])||(r[e]=0),r[e]+=1,n+=1,n%100==0&&chrome.runtime.sendMessage({action:"justTrack",data:{},tracking:{fce:"trackStatsDownloadTotal",param:n}}),r[e]%10==0&&chrome.runtime.sendMessage({action:"justTrack",data:{},tracking:{fce:"trackStatsDownloadDaily",param:r[e]}}),reduceArraySize(r,15),r=JSON.stringify(r),chrome.storage.sync.set({downloadCounterDaily:r,downloadCounterTotal:n})})}catch(t){}}function _(e,t){var r="";return r=null==pxVariables.translations?chrome.i18n.getMessage(e):pxVariables.translations[e],""==r||"uncefined"==r?t:r}function loadLocalisationFile(e,t,r,n){$.getJSON(chrome.extension.getURL("/_locales/"+e+"/messages.json"),function(e){return n(e)}).fail(function(){$.getJSON(chrome.extension.getURL("/_locales/"+t+"/messages.json"),function(e){return n(e)}).fail(function(){$.getJSON(chrome.extension.getURL("/_locales/"+r+"/messages.json"),function(e){return n(e)}).fail(function(){return n(null)})})})}function showLoader(e,t){var r=$(t).parent().find(".pxdownloader_spinnerWrapper, .flickrdownloader_spinnerWrapper");if(e){t.addClass("loading");var n=$(t).position();r.css({top:n.top,left:n.left}),r.show(),$(t).css("visibility","hidden")}else t.removeClass("loading"),r.hide(),$(t).css("visibility","visible")}function onReady(){pxVariables.currentPhotoInfo=null,getTodayDownloaded(function(e){pxVariables.todayDownloaded=e})}function documentLoaded(){getOptions({uiLanguage:config.currentLocale},function(e){config.currentLocale=e.uiLanguage;var t=chrome.runtime.getManifest();loadLocalisationFile(config.currentLocale,chrome.i18n.getUILanguage(),t.default_locale,function(e){null!=e?$.each(e,function(e,t){pxVariables.translations[e]=t.message}):pxVariables.translations=null,translateDocument()})})}String.prototype.startsWith=function(e){return 0==this.indexOf(e)},String.prototype.endsWith=function(e){return this.lastIndexOf(e)==this.length-1},Array.prototype.clean=function(e){for(var t=0;t<this.length;t++)this[t]==e?(this.splice(t,1),t--):"undefined"==typeof e&&""==this[t]&&(this.splice(t,1),t--);return this},Object.size=function(e){var t,r=0;for(t in e)e.hasOwnProperty(t)&&r++;return r};