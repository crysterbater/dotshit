function showPopupAvailableSizes(o){createPopupAvailableSizes(o);togglePopup(!0)}function createPopupAvailableSizes(o){var e=$("html > body > #flickrdownloaderPopup");e.size()>0&&e.remove();var e=$(pxVariables.popupHtml),i=e.find("#flickrdownloaderPopupContent");i.html('<div id="flickrdownloader_downloadImage">\n	<div class="flickrdownloader_spinnerWrapper"><div class="flickrdownloader_spinner large"></div></div>\n	<div class="flickrdownloader_loadedImageWrap">\n		<img id="flickrdownloader_loadedImg" src="" alt=""/>\n	</div>\n	<div class="flickrdownloader_loadedSizesWrap">\n		<div class="flickrdownloader_loadedSizesList">\n		</div>\n	</div>\n	<div class="clear"></div>\n</div>\n'),e.find("#flickrdownloaderPopupHeader").html("Available sizes of selected photo"),e.find("#flickrdownloaderPopupControls").html('<button id="flickrdownloaderCancel" class="flickrdownloaderButton cancel">Cancel</button>'),i.find(".flickrdownloader_loadedImageWrap, .flickrdownloader_loadedSizesWrap").hide(),i.find(".flickrdownloader_spinnerWrapper").show(),e.find(".flickrdownloaderPopupBg, .flickrdownloaderClosePopup, #flickrdownloaderCancel").click(function(){togglePopup(!1)}),fillPopupData(e),$("html > body").append(e);var t=chrome.extension.getURL("img/ic_download.png"),a=chrome.extension.getURL("img/ic_new_window.png"),n=new FlickrApi;return n.getPhotoSizes(o,function(e,r){if(1==e){for(var l=$('<ul id="loadedSizes"/>'),d=!1,s=0;s<r.length;s++)!function(){var e=r[s],c=Math.min(e.height,e.width);if(!d&&(c>=320||!r.hasOwnProperty(s+1))){d=!0;var f=i.find("#flickrdownloader_loadedImg");if(f.attr("src",e.source),f.parent().css("overflow","hidden"),e.height<e.width){var p=320/e.height;f.attr("height",320),f.css("marginLeft",-((e.width*p-320)/2)+"px")}else{var p=320/e.width;f.attr("width",320),f.css("marginTop",-((e.height*p-320)/2)+"px")}}var h=$('<i class="download" title="Download this size of photo to your computer"><img src="'+t+'" alt=""/></i><div class="flickrdownloader_spinnerWrapper small"><div class="flickrdownloader_bg"></div><div class="flickrdownloader_spinner"></div></div>');h.click(function(){var i=$(this);i.hasClass("loading")||(showLoader(!0,i),chrome.runtime.sendMessage({action:"justTrack",data:{},tracking:{fce:"trackDownload",param:o,param2:e.label}}),n.getPhotoInfo(o,function(o,t){showLoader(!1,i),1==o?(chrome.runtime.sendMessage({action:"download",src:e.source,data:t}),window.close()):alert(t)}))});var u=$('<i class="open" title="Open this size of photo in a new tab"><img src="'+a+'" alt=""/></i>');u.click(function(){chrome.runtime.sendMessage({action:"justTrack",data:{},tracking:{fce:"trackViewFullSize",param:o,param2:e.label}}),chrome.runtime.sendMessage({action:"openNewTab",src:e.source,active:!0}),window.close()});var g=$('<li><span class="size">'+e.width+"&nbsp;x&nbsp;"+e.height+"px</span></li>");g.append(h),g.append(u),l.append(g)}();i.find(".flickrdownloader_loadedSizesWrap .flickrdownloader_loadedSizesList").append(l),i.find(".flickrdownloader_spinnerWrapper").hide(),i.find(".flickrdownloader_loadedImageWrap, .flickrdownloader_loadedSizesWrap").show()}}),e}function createPopupLimitExceeded(){var o=$("html > body > #flickrdownloaderPopup");if(o.size()>0)return o;var o=$(pxVariables.popupHtml);o.find("#flickrdownloaderPopupHeader").html("Flickr downloader limit reached"),o.find("#flickrdownloaderPopupControls").html('	<button id="flickrdownloaderCancel" class="flickrdownloaderButton cancel">Cancel</button>\n	<button id="flickrdownloaderDownload" class="flickrdownloaderButton success" onclick="location.href=\''+pxVariables.proVersionLink+"';\">Download</button>");var e=o.find("#flickrdownloaderPopupContent");return e.html('<div class="flickrdownloaderTextWrap">\n	<div class="flickrdownloaderText">\n		<p>\n			A free version allows you to download '+config.downloadLimit+' photos per day.<br />\n			You have just reached this limit.<br />\n			If you need to download more photos, please buy a Pro version of this extension or wait for next day.<br />\n			By purchasing a <a href="'+pxVariables.proVersionLink+'">Pro version</a> you support the developer of this extension.\n		</p>\n		<h2>Advantages of Pro version:</h2>\n		<ul>\n			<li>Unlimited downloading of photos</li>\n			<li>Ability to change filename format of saving file</li>\n			<li>Change UI language (currently are supported languages CS and EN)</li>\n			<li>Ask for directory before download any photo or not</li>\n			<li>Set default location for downloaded images (relative to default download folder of your browser)</li>\n			<li>Download images on Seacrh page</li>\n			<li>Download images on Set of photos page</li>\n		</ul>\n	</div>\n</div>\n'),o.find("#flickrdownloaderCancel").click(function(){chrome.runtime.sendMessage({action:"justTrack",data:{},tracking:{fce:"trackPopupOnPageBuyProCancel"}})}),o.find("#flickrdownloaderDownload").click(function(){chrome.runtime.sendMessage({action:"justTrack",data:{},tracking:{fce:"trackPopupOnPageBuyProDownload"}})}),o.find(".flickrdownloaderPopupBg, .flickrdownloaderClosePopup, #flickrdownloaderCancel").click(function(){togglePopup(!1)}),fillPopupData(o),$("html > body").append(o),o}function fillPopupData(o){if(o.find("#versionNumber").size()>0){var e=chrome.runtime.getManifest();o.find("#versionNumber").html(e.version)}o.find("#downloadedToday").html(pxVariables.todayDownloaded),!config.isPro&&config.downloadLimit>0?(o.find("#downloadLimit").html("/"+config.downloadLimit),o.find("#downloadLimit").show()):o.find("#downloadLimit").hide(),config.isPro?o.find(".onlyPro").show():o.find(".onlyNoPro").show()}function togglePopup(o){var e=$("#flickrdownloaderPopup");1!=o?(e.fadeOut(config.fast),e.remove()):e.fadeIn(config.fast)}function repeat(o,e){setTimeout(function(){o(),repeat(o,e)},e)}function checkContent(o){if(1!=pxVariables.isCheckingContent){switch(pxVariables.isCheckingContent=!0,o){case flickrPageTypes.cameraDetail:case flickrPageTypes.exploreRecent:case flickrPageTypes.setOfPhotos:case flickrPageTypes.favorites:case flickrPageTypes.userPhotos:$("#thumbnails .photo-display-item, #faves .photo-display-item").off().mouseenter(function(){var o=$(this).attr("data-photo-id");downloadButton.off().click(function(){showPopupAvailableSizes(o)}),downloadButton.css("opacity","0.5").hide(),$(this).find(".thumb").prepend(downloadButton),downloadButton.fadeIn(config.slow)}).mouseleave(function(){$(this).find(".thumb .flickrdownloader_wrapper").remove()});break;case flickrPageTypes.commons:$("#tc_photos_grid .tc_photos").off().mouseenter(function(){var o=getPhotoId($(this).find(".tc_photos_link").attr("href"),flickrPageTypes.photoDetail);downloadButton.off().click(function(){showPopupAvailableSizes(o)}),downloadButton.css("opacity","0.5").hide(),$(this).prepend(downloadButton),downloadButton.fadeIn(config.slow)}).mouseleave(function(){$(this).find(".flickrdownloader_wrapper").remove()});break;case flickrPageTypes.under20:$("#artists-list .artist-photos .photo_container").off().mouseenter(function(){var o=getPhotoId($(this).find("a").attr("href"),flickrPageTypes.photoDetail);downloadButton.off().click(function(){showPopupAvailableSizes(o)}),downloadButton.css("opacity","0.5").hide(),$(this).prepend(downloadButton),downloadButton.fadeIn(config.slow)}).mouseleave(function(){$(this).find(".flickrdownloader_wrapper").remove()});break;case flickrPageTypes.galleryOfPhotos:$("#gallery-big-photos .photo_container").off().mouseenter(function(){var o=getPhotoId($(this).find("a.rapidnofollow").attr("href"),flickrPageTypes.photoDetail);downloadButton.off().click(function(){showPopupAvailableSizes(o)}),downloadButton.css("opacity","0.5").hide(),$(this).prepend(downloadButton),downloadButton.fadeIn(config.slow)}).mouseleave(function(){$(this).find(".flickrdownloader_wrapper").remove()});break;case flickrPageTypes.groupPool:$(".photo-collection-view .ui-display-wrapper > .display-item-tile > .ui-display-tile").off().mouseenter(function(){var o=getPhotoId($(this).find("a.ui-display-link").attr("href"),flickrPageTypes.photoDetail);downloadButton.off().click(function(){showPopupAvailableSizes(o)}),downloadButton.css("opacity","0.5").hide(),$(this).prepend(downloadButton),downloadButton.fadeIn(config.slow)}).mouseleave(function(){$(this).find(".flickrdownloader_wrapper").remove()}),$("#pool-photos .pool-photo .thumb").off().mouseenter(function(){var o=$(this).parent().attr("data-photo-id");downloadButton.off().click(function(){showPopupAvailableSizes(o)}),downloadButton.css("opacity","0.5").hide(),$(this).prepend(downloadButton),downloadButton.fadeIn(config.slow)}).mouseleave(function(){$(this).find(".flickrdownloader_wrapper").remove()});break;case flickrPageTypes.searchPhotos:$(".photo-list-view .photo-list-photo-view").off().mouseenter(function(){var o=getPhotoId($(this).find("a.overlay").attr("href"),flickrPageTypes.photoDetail);downloadButton.off().click(function(){showPopupAvailableSizes(o)}),downloadButton.css("opacity","0.5").hide(),$(this).prepend(downloadButton),downloadButton.fadeIn(config.slow)}).mouseleave(function(){$(this).find(".flickrdownloader_wrapper").remove()}),$(".search-photos-collection-view .ui-display.ui-display-tile").off().mouseenter(function(){var o=getPhotoId($(this).find("a.ui-display-link").attr("href"),flickrPageTypes.photoDetail);downloadButton.off().click(function(){showPopupAvailableSizes(o)}),downloadButton.css("opacity","0.5").hide(),$(this).prepend(downloadButton),downloadButton.fadeIn(config.slow)}).mouseleave(function(){$(this).find(".flickrdownloader_wrapper").remove()})}pxVariables.isCheckingContent=!1}}onReady();try{chrome.runtime.sendMessage({method:"downloadImage"})}catch(e){}chrome.extension.onRequest.addListener(function(o,e,i){if("getImagesFromRecent"==o.action){var t=[];$("#thumbnails .photo-display-item, #faves .photo-display-item").each(function(){if($(this).find("img.pc_img").attr("src").indexOf("spaceball.gif")>-1)return!0;var o={id:$(this).attr("data-photo-id"),src:$(this).find("img.pc_img").attr("src"),name:$(this).find(".title").attr("title"),author:$(this).find(".owner").attr("title")};t.push(o)}),i({data:t,action:"getImagesFromRecent"})}else if("getImagesFromCommons"==o.action){var t=[];$("#tc_photos_grid .tc_photos").each(function(){var o={id:getPhotoId($(this).find(".tc_photos_link").attr("href"),flickrPageTypes.photoDetail),src:$(this).find("img").attr("src"),name:$(this).find(".tc_photos_link").attr("title"),author:$(this).find(".tc_inst_name").html()};t.push(o)}),i({data:t,action:"getImagesFromCommons"})}else if("getImagesFromUnder20"==o.action){var t=[];$("#artists-list .artist-photos").each(function(){var o=$(this).parent(),e=o.find(".artist-name").html();o.find(".photo_container").each(function(){var o={id:getPhotoId($(this).find("a").attr("href"),flickrPageTypes.photoDetail),src:$(this).find("img").attr("src"),name:$(this).find("a").attr("title"),author:e};t.push(o)})}),i({data:t,action:"getImagesFromUnder20"})}else if("getImagesFromGallery"==o.action){var t=[];$("#gallery-big-photos .photo_container").each(function(){var o={id:getPhotoId($(this).find("a.rapidnofollow").attr("href"),flickrPageTypes.photoDetail),src:$(this).find("a.rapidnofollow img").attr("src"),name:$(this).find("a.rapidnofollow").attr("title"),author:""};t.push(o)}),i({data:t,action:"getImagesFromGallery"})}else if("getImagesFromGroupPool"==o.action){var t=[];$(".photo-collection-view .ui-display-wrapper > .display-item-tile").each(function(){var o=$(this).find("img.ui-display-image").attr("src");if(o.indexOf("spaceball.gif")>-1)return!0;var e={id:getPhotoId($(this).find("a.ui-display-link").attr("href"),flickrPageTypes.photoDetail),src:o,name:$(this).find(".meta-bar .title a").attr("title"),author:$(this).find(".meta-bar .attribution a").attr("title")};t.push(e)}),$("#pool-photos .pool-photo").each(function(){var o=$(this).find("img.pc_img").attr("src");if(o.indexOf("spaceball.gif")>-1||o.indexOf("spaceout.gif")>-1)return!0;var e={id:$(this).attr("data-photo-id"),src:o,name:$(this).find("a.title").html(),author:$(this).find("a.owner").html()};t.push(e)}),i({data:t,action:"getImagesFromGroupPool"})}else if("getImagesFromSearch"==o.action){var t=[];$(".photo-list-view .photo-list-photo-view").each(function(){var o=$(this).css("background-image").replace("url(","");if(o.indexOf("spaceball.gif")>-1||"none"==o)return!0;o=o.substring(0,o.length-1);var e={id:getPhotoId($(this).find("a.overlay").attr("href"),flickrPageTypes.photoDetail),src:o,name:$(this).find(".title").html(),author:""};t.push(e)}),$(".search-photos-collection-view .ui-display.ui-display-tile").each(function(){var o=$(this).find(".ui-display-image").attr("src");if(o.indexOf("spaceball.gif")>-1||o.indexOf("spaceout.gif")>-1)return!0;var e={id:getPhotoId($(this).find("a.ui-display-link").attr("href"),flickrPageTypes.photoDetail),src:o,name:$(this).find(".title a").html(),author:$(this).find(".attribution a").html()};t.push(e)}),i({data:t,action:"getImagesFromSearch"})}}),chrome.runtime.onMessage.addListener(function(o){if("showPopupOnPage"==o.action){var e=o.data;switch(e.popupType){case"limitExceeded":togglePopup(!1),createPopupLimitExceeded(),togglePopup(!0)}}}),$(document).ready(function(){var o=chrome.runtime.getManifest();chrome.runtime.sendMessage({action:"justTrack",data:{},tracking:{fce:"trackVersion",param:o.version}});var e=getCurrentPageType(location.href),i="";switch(e){case flickrPageTypes.cameraDetail:case flickrPageTypes.setOfPhotos:case flickrPageTypes.userPhotos:case flickrPageTypes.favorites:case flickrPageTypes.exploreRecent:i="#thumbnails";break;case flickrPageTypes.commons:i="#tc_photos_grid";break;case flickrPageTypes.under20:i="#artists-list";break;case flickrPageTypes.galleryOfPhotos:i="#gallery-big-photos";break;case flickrPageTypes.groupPool:i=".photo-collection-view, #pool-photos";break;case flickrPageTypes.searchPhotos:i=".photo-list-view, .search-photos-collection-view"}var t=null;$(i).bind("DOMSubtreeModified",function(){$(this).unbind("DOMSubtreeModified"),clearTimeout(t),t=setTimeout(function(){checkContent(e)},100)}),repeat(function(){checkContent(e)},1e3),t=setTimeout(function(){checkContent(e)},100)});var downloadButton=$('<div class="flickrdownloader_wrapper">\n	<div class="flickrdownloader_btn" title="Show available sizes"></div>\n</div>');