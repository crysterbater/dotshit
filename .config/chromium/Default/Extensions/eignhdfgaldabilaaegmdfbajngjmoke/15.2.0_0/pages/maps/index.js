cjModules.define(function(){"use strict";return function(e,t){function a(e){e&&C.setPosition(e),C.setVisible(Boolean(e))}function n(e){return cjBasics.ajax({dataType:"JSON",url:"https://maps.googleapis.com/maps/api/place/textsearch/json?key="+g.key+"&query="+encodeURIComponent(e)}).then(function(e){if("OK"===e.status){var t=e.results[0];if(t.geometry){var a=t.geometry.viewport;return t.geometry.bounds=new google.maps.LatLngBounds(new google.maps.LatLng(a.southwest.lat,a.southwest.lng),new google.maps.LatLng(a.northeast.lat,a.northeast.lng)),delete t.geometry.viewport,t}}return Promise.reject(e.status)})}function i(e){return cjBasics.ajax({dataType:"JSON",url:"https://maps.googleapis.com/maps/api/place/details/json?key="+g.key+"&placeid="+e}).then(function(e){return"OK"===e.status?e.results:Promise.reject(e.status)})}function o(e){e.geometry.viewport?v.fitBounds(e.geometry.viewport):(v.setCenter(e.geometry.location),v.setZoom(17)),j.setBounds(v.getBounds()),v.panBy(0,-80)}function s(e){h.textContent="";var t=cjMaterial.createElement("title",{label:e.placeName});if(h.appendChild(t),e.address&&e.address.length>0){var a=cjMaterial.createElement("secondarytext");a.innerHTML=e.address,h.appendChild(a)}if(e.transitContainer){var n=document.createElement("div");n.className="gm-style",n.appendChild(e.transitContainer),h.appendChild(n)}y=e.mapsUrl,y||i(e.placeId).then(function(e){y=e.url});var o=cjMaterial.createElement("button",{color:"#4285f4",label:cjExtensions.i18n("cj_i18n_00124","View on Google Maps"),onClick:function(){bmBasics.openTab(y)}});h.appendChild(o);var s=cjMaterial.createElement("fab",{iconName:"__mdi:directions",onClick:function(){bmBasics.openTab(e.directionsUrl)}});h.appendChild(s),h.classList.add("bm-p-maps__results--visible")}function r(e){w&&L[w].layer.setMap(null),w=e;var t=L[e];if(t){if(!t.loaded){t.loaded=!0;var a=t.layerName;a&&(t.layer=new google.maps[a])}t.layer.setMap(v)}}function l(){var e=cjMaterial.createElement("drawer",{color:"#4285f4"}),t=bmElements.createElement("servicelogo",{label:cjExtensions.i18n("cj_i18n_00423","Maps"),color:"#4285f4"});e.appendChild(t);var a=bmElements.createElement("drawertabs",{items:L,onChange:r,onActiveClick:function(){a.selected=null,r(null)}});e.appendChild(a);var n={hybrid:{iconName:"__mdi:satellite",label:cjExtensions.i18n("cj_i18n_00125","Satellite")},terrain:{iconName:"__mdi:terrain",label:cjExtensions.i18n("cj_i18n_00126","Terrain"),divider:!0},places:{label:cjExtensions.i18n("cj_i18n_00127","Your places"),newTabUrl:E+"@37.0625,-95.677068,4z/data=!4m2!10m1!1e2?authuser="+g.account.authuser,iconName:"__mdi:place",external:!0},contributions:{label:cjExtensions.i18n("cj_i18n_00128","Your contributions"),newTabUrl:E+"contrib/?authuser="+g.account.authuser,iconName:"__mdi:rate_review",external:!0},timeline:{label:cjExtensions.i18n("cj_i18n_00129","Your timeline"),newTabUrl:E+"timeline?authuser="+g.account.authuser,iconName:"__mdi:timeline",external:!0}};return f=bmElements.createElement("drawertabs",{items:n,onChange:function(e){n[e].external?bmBasics.openTab(n[e].newTabUrl):v.setMapTypeId(e)},onActiveClick:function(){v.setMapTypeId("roadmap"),f.selected=null}}),e.appendChild(f),e}function c(){C.setVisible(!1)}function p(e,t){var a={api:"1"};return"0"!==g.account.authuser&&(a.authuser=g.account.authuser),e?a.destination_place_id=e:a.destination=t.split(" ").join("+"),cjBasics.urls.create(E+"dir/",a)}function d(e,t,a){if(!t&&e)return cjBasics.urls.insertParameter(e,"authuser",g.account.authuser);var n={api:"1",query:a.split(" ").join("+")};return"0"!==g.account.authuser&&(n.authuser=g.account.authuser),t&&(n.query_place_id=t),cjBasics.urls.create(E+"search/",n)}function m(e){e.geometry.location?a(e.geometry.location):c(),o(e);var t=e.name||e.address_components[0].short_name,n=e.place_id;s({placeId:e.place_id,placeName:t,address:e.formatted_address,mapsUrl:d(e.url,n,t),directionsUrl:p(n,t)})}function u(){c(),h.classList.remove("bm-p-maps__results--visible")}function b(){bmBasics.toggleLoading("on",e);var t=l();e.appendChild(t);var i=cjMaterial.createElement("appbar",{floating:!0,light:!0}),o=cjMaterial.createElement("iconbutton",{iconName:"__mdi:menu",onClick:function(){t.open()}});i.appendChild(o),_=bmElements.createElement("searchbox",{raised:!0,onClear:u,onSubmitAlt:function(e){var t=cjBasics.urls.create(E+"search/",{api:"1",query:e,authuser:g.account.authuser});bmBasics.openTab(t)}}),T(_.select),i.appendChild(_),h=cjMaterial.createElement("card",{withPadding:!0}),h.classList.add("bm-p-maps__results"),_.appendChild(h);var r=bmElements.createElement("maintoolbarbuttons","maps");i.appendChild(r),e.appendChild(i);var c=cjMaterial.createElement("card");c.classList.add("bm-p-maps__maptype"),c.dataset.satelliteText=cjExtensions.i18n("cj_i18n_00289","Satellite"),c.dataset.mapText=cjExtensions.i18n("cj_i18n_00290","Map"),c.addEventListener("click",function(){var e="hybrid"===v.mapTypeId;v.setMapTypeId(e?"roadmap":"hybrid")}),e.appendChild(c);var p=cjMaterial.createElement("container");p.classList.add("bm-p-maps__map"),e.appendChild(p),B.then(function(){v=new google.maps.Map(p,{clickableIcons:!0,panControl:!1,center:new google.maps.LatLng(10,0),minZoom:1,zoom:1,mapTypeId:"roadmap",mapTypeControl:!1,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM,style:google.maps.ZoomControlStyle.SMALL},styles:[{featureType:"administrative",elementType:"geometry.fill",stylers:[{visibility:"off"}]}]}),v.panBy(0,-32),cjBasics.loadScriptFile("https://www.google.com/jsapi").then(function(){var t=google.loader.ClientLocation;t?(v.setCenter({lat:t.latitude,lng:t.longitude}),v.setZoom(6),j.setBounds(v.getBounds())):e.classList.add("bm-p-maps--large-zoom")});var t=v.getStreetView();google.maps.event.addListener(t,"visible_changed",function(){e.classList.toggle("streetview",t.getVisible())}),C=new google.maps.Marker({map:v,visible:!1}),google.maps.InfoWindow.prototype.setPosition=a,google.maps.InfoWindow.prototype.setContent=function(e){this.setMap(null);var t=e.querySelector(".title").textContent;_.value=t;var a=e.querySelector(".view-link a").href;a=cjBasics.urls.insertParameter(a,"authuser",g.account.authuser);var n=e.querySelector(".transit-container");if(n){var i=n.querySelector(".transit-title:not([style]) span");n.removeChild(i.parentNode),t=i.textContent}s({placeName:t,address:e.querySelector(".address").innerHTML,transitContainer:n,mapsUrl:a,directionsUrl:cjBasics.urls.insertParameter(a,"daddr",t.split(" ").join("+"))})},google.maps.InfoWindow.prototype.open=function(){},v.addListener("maptypeid_changed",function(){var t="hybrid"===v.mapTypeId;f.selected=v.mapTypeId,e.classList.toggle("satellite",t)}),v.addListener("zoom_changed",function(){e.classList.toggle("bm-p-maps--large-zoom",1===v.zoom)}),j=new google.maps.places.Autocomplete(_.inputElement),j.bindTo("bounds",v),google.maps.event.addListener(j,"place_changed",function(){var e=j.getPlace();e.geometry?m(e):n(_.value).then(m),_.blur()}),bmBasics.toggleLoading("off",e)})}var h,_,f,y,v,j,C,w,T=t.onPageDisplay,E="https://www.google.com/maps/";t.setOpenInNewHandler(function(){var e=E+"?authuser="+g.account.authuser;y&&C.getVisible()&&(e=y),bmBasics.openTab(e)});var L={traffic:{iconName:"__mdi:traffic",label:cjExtensions.i18n("cj_i18n_00032","Traffic"),layerName:"TrafficLayer"},transit:{iconName:"__mdi:directions_transit",label:cjExtensions.i18n("cj_i18n_00033","Public Transport"),layerName:"TransitLayer"},bicycling:{iconName:"__mdi:directions_bike",label:cjExtensions.i18n("cj_i18n_00034","Cycling"),layerName:"BicyclingLayer"}},B=new Promise(function(e){var t="mapsPageApiCallback";window[t]=function(){delete window[t],e()};var a=cjBasics.urls.create("https://maps.googleapis.com/maps/api/js",{key:g.key,callback:t,libraries:"places",language:g.lang});cjBasics.loadScriptFile(a)});b()}});